# フラクタル探索サイト 要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名
**Fractal Explorer** - インタラクティブなフラクタル図形探索サイト

### 1.2 目的
- フラクタル図形の美しさと数学的特性を一般ユーザーにも分かりやすく提供
- リアルタイムでのフラクタル図形生成とインタラクティブな探索体験
- WebGPU等の最新技術を活用した高性能レンダリングの実証

### 1.3 ターゲットユーザー
- **主要ターゲット**: 数学・科学に興味がある一般ユーザー
- **副次ターゲット**: 教育関係者、研究者、Web技術者
- **年齢層**: 中学生以上（数学的背景知識は不要）

## 2. 機能要件

### 2.1 フラクタル図形

#### 2.1.1 実装予定のフラクタル
1. **マンデルブロ集合**
   - 複素数平面上での収束・発散判定
   - ズーム倍率: 最大10^15倍
   - カスタムカラーパレット対応

2. **ジュリア集合**
   - パラメータc値のリアルタイム調整
   - プリセット美麗パターン提供
   - アニメーション機能

3. **シェルピンスキーの三角形**
   - 再帰的分割アルゴリズム
   - 段階的構築アニメーション
   - カオスゲーム実装

4. **コッホ雪片**
   - 反復レベル調整（1-8段階）
   - 構築過程の可視化
   - 面積・周囲長の計算表示

5. **バーニングシップ**
   - マンデルブロ集合の変種
   - 独特な船型パターン
   - 高倍率ズーム対応

6. **ニュートン・ラフソン法フラクタル**
   - 多項式の根の収束域可視化
   - 方程式のカスタマイズ
   - 収束回数による色分け

#### 2.1.2 共通機能
- **ズーム・パン操作**
  - マウスホイール: ズームイン/アウト
  - ドラッグ: パン移動
  - ダブルクリック: 指定点中心ズーム
  - キーボードショートカット対応

- **パラメータ調整**
  - リアルタイムスライダー
  - 数値直接入力
  - プリセット値の保存/読み込み
  - URL共有機能

### 2.2 レンダリング機能

#### 2.2.1 レンダリング方式（段階的実装）
1. **Phase 1: CPU基本レンダリング**
   - Canvas 2D APIを使用
   - シングルスレッド実装
   - 基本的なフラクタル描画

2. **Phase 2: マルチスレッドCPUレンダリング**
   - Web Workersによる並列計算
   - タイル分割レンダリング（8×8グリッド）
   - プログレッシブ表示

3. **Phase 3: GPU アクセラレーション**
   - WebGPU コンピュートシェーダー
   - WebGL フォールバック実装
   - リアルタイム60fps目標

4. **Phase 4: WASM最適化**
   - Rust製計算モジュール
   - SIMD命令活用
   - メモリ効率最適化

#### 2.2.2 パフォーマンス要件
- **初期表示**: 1秒以内
- **インタラクティブ操作**: 60fps維持
- **高解像度レンダリング**: 4K対応
- **メモリ使用量**: 512MB以下

### 2.3 ユーザーインターフェース

#### 2.3.1 レイアウト構成
```
┌─────────────────────────────────────────┐
│ Header (Navigation, Logo)               │
├─────────────────────────────────────────┤
│ ┌─────────────────────┐ ┌─────────────┐ │
│ │                     │ │ Control     │ │
│ │ Fractal Viewport    │ │ Panel       │ │
│ │ (Main Canvas)       │ │ - Parameters│ │
│ │                     │ │ - Colors    │ │
│ │                     │ │ - Presets   │ │
│ └─────────────────────┘ └─────────────┘ │
├─────────────────────────────────────────┤
│ Status Bar (Coordinates, Zoom, Info)   │
├─────────────────────────────────────────┤
│ Footer                                  │
└─────────────────────────────────────────┘
```

#### 2.3.2 コンポーネント仕様
- **フラクタルビューアー**
  - Canvas要素（メイン描画領域）
  - オーバーレイUI（座標表示、ロード状態）
  - フルスクリーンモード対応

- **コントロールパネル**
  - パラメータスライダー
  - カラーパレット選択
  - レンダリング設定
  - プリセット管理

- **ナビゲーション**
  - フラクタル種類選択
  - ギャラリーページリンク
  - ヘルプ・About
  - 設定メニュー

#### 2.3.3 レスポンシブデザイン
- **デスクトップ** (1920×1080+): フル機能UI
- **タブレット** (768×1024): サイドパネル折りたたみ
- **モバイル** (375×667): ボトムシート形式

### 2.4 SEO・アクセシビリティ

#### 2.4.1 SEO対策
- **メタデータ最適化**
  - 各ページ固有のtitle/description
  - Open Graph / Twitter Cards
  - 構造化データ（Schema.org）

- **コンテンツ戦略**
  - 教育的コンテンツ（フラクタルの解説）
  - ギャラリーページ（美麗画像集）
  - 技術解説ブログ（実装解説）

- **技術的SEO**
  - Astro静的サイト生成（SSG）
  - sitemap.xml自動生成
  - Core Web Vitals最適化
  - Server-side rendering for content pages

#### 2.4.2 アクセシビリティ
- **WCAG 2.1 AA準拠**
  - カラーコントラスト比4.5:1以上
  - キーボードナビゲーション対応
  - スクリーンリーダー対応

- **操作性向上**
  - フォーカス状態の明確な表示
  - エラーメッセージの分かりやすい表示
  - 操作の取り消し機能

## 3. 非機能要件

### 3.1 パフォーマンス要件
- **ページ読み込み時間**: 3秒以内
- **フレームレート**: 60fps（インタラクション時）
- **メモリ使用量**: 512MB以下
- **CPU使用率**: 80%以下

### 3.2 互換性要件
- **ブラウザサポート**
  - Chrome 90+
  - Firefox 88+
  - Safari 14+
  - Edge 90+

- **デバイス要件**
  - CPU: 現代的なマルチコアプロセッサ
  - RAM: 4GB以上推奨
  - GPU: WebGPU対応（オプション）

### 3.3 セキュリティ要件
- **データ保護**
  - ユーザーデータはローカルストレージのみ
  - 外部API呼び出しなし
  - プライバシーポリシー準拠

- **セキュリティヘッダー**
  - Content Security Policy (CSP)
  - X-Frame-Options
  - Strict-Transport-Security

## 4. 技術仕様

### 4.1 技術スタック
```typescript
// Frontend Framework
Astro 4.0+ with TypeScript 5.3+
React 18.3+ (for interactive components)

// Styling
Tailwind CSS 3.4+
PostCSS + Autoprefixer

// Development Tools
Vite 5.0+ (Build Tool - built into Astro)
Biome 2.1.1 (Linting/Formatting)

// High Performance Computing
WebGPU (Primary)
WebGL 2.0 (Fallback)
Web Workers (Parallel Computing)
WebAssembly with Rust

// Deployment
GitHub Pages (Static Hosting)
GitHub Actions (CI/CD)
```

### 4.2 アーキテクチャ設計

#### 4.2.1 レイヤード・アーキテクチャ
```
┌─────────────────┐
│ Presentation    │ React Components, UI
├─────────────────┤
│ Application     │ Hooks, State Management
├─────────────────┤
│ Domain          │ Fractal Logic, Algorithms
├─────────────────┤
│ Infrastructure  │ Canvas, WebGPU, Workers
└─────────────────┘
```

#### 4.2.2 主要モジュール
- **フラクタルエンジン**: 計算・レンダリング統合管理
- **GPU レンダラー**: WebGPU/WebGL描画処理
- **ワーカーマネージャー**: マルチスレッド処理制御
- **UI状態管理**: パラメータ・表示状態管理

### 4.3 データフロー

```typescript
User Input → UI Components → State Management → Fractal Engine
                ↓
         Worker Manager → Web Workers → Calculations
                ↓
         GPU Renderer → WebGPU/WebGL → Canvas Display
```

## 5. 実装計画

### 5.1 マイルストーン

#### Phase 1: 基盤構築
- [x] プロジェクト環境構築
- [ ] Astro + TypeScript セットアップ
- [ ] React統合・Tailwind CSS導入
- [ ] 基本レイアウト・ナビゲーション
- [ ] Canvas API基本実装

#### Phase 2: フラクタル基本実装
- [ ] マンデルブロ集合（CPU版）
- [ ] 基本的なズーム・パン機能
- [ ] パラメータ調整UI
- [ ] カラーパレット機能

#### Phase 3: マルチスレッド対応
- [ ] Web Workers実装
- [ ] タイル分割レンダリング
- [ ] プログレッシブ表示
- [ ] パフォーマンス最適化

#### Phase 4: 追加フラクタル
- [ ] ジュリア集合
- [ ] シェルピンスキーの三角形
- [ ] コッホ雪片
- [ ] その他フラクタル

#### Phase 5: GPU最適化
- [ ] WebGPU実装
- [ ] WebGLフォールバック
- [ ] シェーダー最適化
- [ ] パフォーマンス向上

#### Phase 6: WASM最適化
- [ ] Rust製WASMモジュール
- [ ] SIMD最適化
- [ ] メモリ効率改善
- [ ] 最終パフォーマンス調整

#### Phase 7: SEO・アクセシビリティ
- [ ] Astro SSG最適化
- [ ] メタデータ最適化
- [ ] アクセシビリティ改善
- [ ] パフォーマンス監視

#### Phase 8: デプロイ・運用
- [ ] GitHub Actions CI/CD
- [ ] GitHub Pages デプロイ
- [ ] ドキュメント整備
- [ ] 運用監視設定

### 5.2 品質保証

#### 5.2.1 テスト戦略
- **ユニットテスト**: フラクタル計算ロジック
- **統合テスト**: コンポーネント間連携
- **E2Eテスト**: ユーザーシナリオ
- **パフォーマンステスト**: レンダリング性能

#### 5.2.2 コード品質
- **TypeScript**: 厳密な型チェック
- **Biome**: リンティング・フォーマット
- **コードレビュー**: 機能実装時の品質確認
- **ドキュメント**: API仕様・アーキテクチャ文書

## 6. リスク管理

### 6.1 技術的リスク
- **WebGPU対応状況**: フォールバック実装で対応
- **ブラウザ互換性**: 段階的degradation実装
- **パフォーマンス**: プロファイリング・最適化

### 6.2 スケジュールリスク
- **技術調査時間**: 余裕を持った計画
- **実装複雑度**: MVP優先・段階的機能追加
- **テスト工数**: 継続的テスト実装

## 7. 成功指標

### 7.1 定量指標
- **パフォーマンス**: Core Web Vitals 90点以上
- **アクセシビリティ**: Lighthouse Accessibility 95点以上
- **SEO**: Lighthouse SEO 90点以上
- **ユーザビリティ**: タスク完了率 90%以上

### 7.2 定性指標
- **ユーザー体験**: 直感的操作・美しい表示
- **教育価値**: フラクタルへの理解向上
- **技術価値**: 最新Web技術の実証
- **保守性**: 可読性・拡張性の高いコード

---

*最終更新: 2024年12月*
*バージョン: 1.0* 